var SessionExpiredNotification=function(n,t,i,r,u){function e(t){var i=this;i.element=t;i.$element=n(t);i.cartHasProducts=i.$element.data("cart-has-products")===!0;i.updateSessionUrl=i.$element.data("update-session-url");i.clearCartUrl=i.$element.data("clear-cart-url");i.logoutUrl=i.$element.data("logout-url");i.sessionAlmostExpiredTemplate=i.$element.find("[data-ref=session-almost-expired-container]").html();i.sessionAlreadyExpiredTemplate=i.$element.find("[data-ref=session-already-expired-container]").html();i.timer=null;i.scrollTimer=null;i.openModalState=f.SESSION_NOT_INITED;i.sessionCleared=!1;i.interval=15e3;i.scrollDelay=5e3;i.onScrollBind=!1}var f={SESSION_NOT_INITED:"",SESSION_ALMOST_EXPIRED:"almost",SESSION_ALREADY_EXPIRED:"already"},o={BASKET_EXPIRED:"basket_expired",BASKET_ALMOST_EXPIRED:"basket_almost_expired"};return e.prototype.Init=function(){var r=this;console.log("SessionExpiredNotification is inited");r.cartHasProducts&&r.InitTimer();n(document).on("session:update",function(){r.InitTimer()});n(document).off("click","[data-ref=session-almost-expired-order-continue]").on("click","[data-ref=session-almost-expired-order-continue]",function(n){n.preventDefault();r.userUpdatesSession=!0;r.InitTimer();r.openModalState=f.SESSION_NOT_INITED;var u=t.GetOrAddComponent(i);u.Close()});n(document).off("click","[data-ref=session-almost-expired-order-clear]").on("click","[data-ref=session-almost-expired-order-clear]",function(n){n.preventDefault();r.FinalAction(r.clearCartUrl)});n(document).off("click","[data-ref=session-already-expired-order-restart]").on("click","[data-ref=session-already-expired-order-restart]",function(n){n.preventDefault();window.localStorage&&window.localStorage.setItem(u.START_AFTER_RELOAD,!0);r.FinalAction(r.clearCartUrl)})},e.prototype.InitTimer=function(){var t=this;if(!t.onScrollBind){n(window).on("scroll",function(){t.scrollTimer&&(clearTimeout(t.scrollTimer),t.scrollTimer=null);t.scrollTimer=setTimeout(function(){t.UpdateTimer()},t.scrollDelay)});t.onScrollBind=!0}t.UpdateTimer()},e.prototype.UpdateTimer=function(){var u=this;r.postBackgroundCall(u.updateSessionUrl).done(function(){u.ClearTimer();u.SetTimer(function(){var h,c,s;if(u.userUpdatesSession){u.userUpdatesSession=!1;return}if((h=parseInt(n.cookie(o.BASKET_EXPIRED)),h)&&(c=parseInt(n.cookie(o.BASKET_ALMOST_EXPIRED)),c)&&(s=(new Date).getTime()/1e3|0,s)){var l=h-s,a=c-s,e=t.GetOrAddComponent(i);if(a>0){if(u.openModalState===f.SESSION_ALREADY_EXPIRED){document.location.href="/";return}u.openModalState===f.SESSION_ALMOST_EXPIRED&&(u.openModalState=f.SESSION_NOT_INITED,e.Close());return}a<=0&&l>0?(u.openModalState=f.SESSION_ALMOST_EXPIRED,e.ClearCloseCallbacks(),e.Open(null,u.sessionAlmostExpiredTemplate,"dark-background"),e.OnClose(function(){u.InitTimer()})):l<=0&&(u.openModalState=f.SESSION_ALREADY_EXPIRED,e.ClearCloseCallbacks(),e.Open(null,u.sessionAlreadyExpiredTemplate,"dark-background"),e.OnClose(function(){document.location.href="/";u.requestProcessing=!1}),u.sessionCleared||(r.postBackgroundCall(u.logoutUrl),u.sessionCleared=!0))}},u.interval)}).fail(function(){u.ClearTimer()})},e.prototype.ClearTimer=function(){var n=this;n.timer&&(clearInterval(n.timer),n.timer=null)},e.prototype.SetTimer=function(n,t){var i=this;i.timer=setInterval(n,t)},e.prototype.FinalAction=function(n){var t=this;t.requestProcessing||(t.requestProcessing=!0,r.postBackgroundCall(n).done(function(){document.location.href="/";t.requestProcessing=!1}).fail(function(){document.location.href="/";t.requestProcessing=!1}))},e}(jQuery,ComponentsFactory,ModalDialogSmall,ServerCall,OrderFlowConstants);$(function(n){var t=n("body").find("[data-component=SessionExpiredNotification]");t.length&&t.each(function(){var n=new SessionExpiredNotification(this);n.Init()})})